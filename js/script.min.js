let serverURL,serverPort,url,id,editing=!1;$(document).ready(()=>{$.ajax({url:"config.json",type:"GET",dataType:"json",success:function(keys){serverURL=keys.SERVER_URL,serverPort=keys.SERVER_PORT,url=`${keys.SERVER_URL}:${keys.SERVER_PORT}`,showItems()},error:function(err){console.log("Sorry, but we couldn't find a config.json!")}}),sessionStorage.userName?(hideRegisterBtn(),hideLoginBtn(),showLogoutBtn(),showAddItemForm()):(showRegisterBtn(),showLoginBtn(),hideLogoutBtn(),hideAddItemForm())}),showItems=(()=>{$.ajax({url:`${url}/allItems`,type:"GET",dataType:"json",success:function(data){console.log(data),$("#cardContainer").find(".row").empty();for(var i=0;i<data.length;i++){let itemCard=`\n                <div class="col-12 col-md-4">\n                <div class="card" data-id="${data[i]._id}">\n                <div class="card-body">\n                <div id="worktitle" class="card-title">\n                <div class="cardImg" style="background-image: url(${url}/${data[i].image_URL}); height: 200px; width: 100%; background-size: contain;background-repeat: no-repeat;background-position: top;" >\n                </div>\n                <h5 class="card-title text-center mt-3" >${data[i].item_name}</h5>\n                <p class="text-center">$ ${data[i].price}</p>`;1==data[i].bought&&(itemCard+='<p class="text-center">Sold out</p>'),itemCard+="</div>",sessionStorage.userID===data[i].user_id&&(itemCard+='<div class="btnSet d-flex justify-content-center">\n                    <button class="btn btn-warning btn-sm mr-1 editBtn">EDIT</button>\n                    <button class="btn btn-danger btn-sm removeBtn">REMOVE</button>\n                    </div>'),itemCard+='<div class="btnSet d-flex justify-content-center">\n                <button class="btn btn-secondary btn-sm mr-1 moreInfoBtn" data-toggle="modal" data-target="#singleItemModal">MORE INFO</button>',sessionStorage.userID&&0==data[i].bought&&(itemCard+='<button class="btn btn-success btn-sm mr-1 buyBtn" data-toggle="modal" data-target="#buyModal">BUY</button>'),itemCard+="</div>\n                </div>\n                </div>\n                </div>",$("#cardContainer").find(".row").append(itemCard)}$("#cardContainer").removeClass("d-none")},error:function(err){console.log(err),console.log("How embarassing, a database error! This never usually happens to me.")}})});const clearForms=()=>{$("input").val(""),$("textarea").val("")},showLoginBtn=()=>{$("#loginBtn").removeClass("d-none")},showLogoutBtn=()=>{$("#logoutBtn").removeClass("d-none")},showRegisterBtn=()=>{$("#registerBtn").removeClass("d-none")},showLoginForm=()=>{$("#userForm").removeClass("d-none"),$("#loginFormBox").removeClass("d-none")},showRegisterForm=()=>{$("#userForm").removeClass("d-none"),$("#registerFormBox").removeClass("d-none")},showAddItemForm=()=>{$("#addItemForm").show()},showEditItemForm=()=>{$("#editModal").modal("show")},hideLoginBtn=()=>{$("#loginBtn").addClass("d-none")},hideLogoutBtn=()=>{$("#logoutBtn").addClass("d-none")},hideRegisterBtn=()=>{$("#registerBtn").addClass("d-none")},hideLoginForm=()=>{$("#userForm").addClass("d-none"),$("#loginFormBox").addClass("d-none")},hideRegisterForm=()=>{$("#userForm").addClass("d-none"),$("#registerFormBox").addClass("d-none")},hideAddItemForm=()=>{$("#addItemForm").hide()},hideEditItemForm=()=>{$("#editModal").addClass("d-none")};$("#loginBtn").click(()=>{$(".main").addClass("d-none"),$("#lUsername").val(null),$("#lPassword").val(null),$("#userForm").removeClass("d-none"),$("#loginFormBox").removeClass("d-none"),$("#registerFormBox").addClass("d-none"),$("#errLogin").empty()}),$("#logoutBtn").click(()=>{hideLogoutBtn(),hideAddItemForm(),showRegisterBtn(),showLoginBtn(),$("#cardContainer").addClass("d-none"),showItems(),sessionStorage.clear()}),$("#registerBtn").click(()=>{$(".main").addClass("d-none"),$("#rUsername").val(null),$("#rEmail").val(null),$("#rPassword").val(null),$("#rConfirmPassword").val(null),$("#errLogin").empty(),hideLoginForm(),$("#userForm").removeClass("d-none"),$("#registerFormBox").removeClass("d-none")}),$("#loginForm").submit(()=>{if(event.preventDefault(),sessionStorage.userID)return void alert("401 error: you don't have permission to be here. Sorry. We don't make the rules.");const username=$("#lUsername").val(),password=$("#lPassword").val();0===username.length||0===password.length?alert("Please enter your username and password!"):$.ajax({url:`${url}/getUser`,type:"POST",data:{username:username,password:password},success:function(result){"user does not exist"===result?($("#errLogin").empty(),$("#errLogin").append('<p class="text-danger">Sorry, user does not exist. </p>')):"invalid password"===result?alert("Oh dear, it looks like you've entered the wrong password."):sessionStorage.username?console.log("401 error: you don't have permission to be here. Sorry. We don't make the rules."):(sessionStorage.setItem("userID",result._id),sessionStorage.setItem("userName",result.username),sessionStorage.setItem("userEmail",result.email),hideRegisterBtn(),hideLoginBtn(),showLogoutBtn(),$("#userForm").addClass("d-none"),$(".main").removeClass("d-none"),$("#addListBtn").removeClass("d-none"),showItems(),showAddItemForm(),$("#errLogin").empty())},error:function(err){console.log(err),console.log("How embarassing, a database error! This never usually happens to me.")}})}),$("#registerForm").submit(()=>{if(event.preventDefault(),sessionStorage.userID)return void alert("401 error: you don't have permission to be here. Sorry. We don't make the rules.");const username=$("#rUsername").val(),email=$("#rEmail").val(),password=$("#rPassword").val(),confirmPassword=$("#rConfirmPassword").val();return 0==username.length?(alert("Please enter a username!"),void showItems()):0==email.length?(alert("Please enter an email address!"),void showItems()):0==password.length?(alert("Please enter a password!"),void showItems()):0==confirmPassword.length?(alert("Please confirm your password!"),void showItems()):password!==confirmPassword?(alert("One of those passwords is not like the other!"),void showItems()):void $.ajax({url:`${url}/users`,type:"POST",data:{username:username,email:email,password:password},success:function(result){console.log(result),"Invalid user"===result?(alert("Sorry, this username is taken."),console.log(sessionStorage),showItems()):(sessionStorage.setItem("userID",result._id),sessionStorage.setItem("userName",result.username),sessionStorage.setItem("userEmail",result.email),$(".main").removeClass("d-none"),hideRegisterForm(),hideRegisterBtn(),hideLoginBtn(),showItems(),showLogoutBtn(),showAddItemForm())},error:function(err){console.log(err),console.log("How embarassing, a database error! This never usually happens to me.")}})}),$("#addItemForm").on("submit",()=>{if(event.preventDefault(),!sessionStorage.userID)return void alert("401 error: you don't have permission to be here. Sorry. We don't make the rules.");let formData=new FormData,itemName=$("#itemName"),itemDescription=$("#itemDescription"),itemPrice=$("#itemPrice"),itemImg=($("input[name=itemType]:checked").val(),$("input[name=itemCondition]:checked").val(),$("#itemImage"));const upload=()=>{formData.append("itemName",itemName.val()),formData.append("itemDescription",itemDescription.val()),formData.append("itemPrice",itemPrice.val()),formData.append("itemType",$("input[name=itemType]:checked").val()),formData.append("itemCondition",$("input[name=itemCondition]:checked").val()),formData.append("itemImg",itemImg[0].files[0]),formData.append("userID",sessionStorage.userID),$.ajax({url:`${url}/addItem`,type:"POST",data:formData,contentType:!1,processData:!1,success:function(result){clearForms(),$("#itemImageLabel").html("Upload image"),showItems()},error:function(err){console.log(err),console.log("How embarrassing, a database error! This never usually happens to me.")}})};if(0!=itemName.val().length&&0!=itemDescription.val().length&&0!=itemPrice.val().length&&void 0!=itemImg[0].files[0]){if("image/jpg"===itemImg[0].files[0].type)return void upload();if("image/jpeg"===itemImg[0].files[0].type)return void upload();if("image/png"===itemImg[0].files[0].type)return void upload();if("image/gif"===itemImg[0].files[0].type)return void upload();alert("Sorry, but the server can't handle this kind of file. Try JPG, JPEG, PNG or GIF.")}else alert("Please add all of the item details!")}),$("#itemImage").change(()=>{const fileName=$("#itemImage")[0].files[0].name;$("#itemImageLabel").html(fileName)}),$("#cardContainer").on("click",".editBtn",function(){if(event.preventDefault(),!sessionStorage.userID)return void alert("401 error: you don't have permission to be here. Sorry. We don't make the rules.");const id=$(this).parent().parent().parent().data("id");console.log(id),$("#editModal").modal("show"),$.ajax({url:`${url}/getItem/${id}`,type:"GET",success:function(item){console.log(item),$("#itemNameEdit").val(item.item_name),$("#itemDescriptionEdit").val(item.item_description),$("#itemPriceEdit").val(item.price),$("#itemIDEdit").val(item._id),$("input[name=itemTypeEdit][value="+item.clothing_type+"]").attr("checked","checked"),$("input[name=itemConditionEdit][value="+item.condition+"]").attr("checked","checked")},error:function(err){console.log(err),console.log("How embarrassing, a database error! This never usually happens to me.")}})}),$("#editItemForm").submit(()=>{if(event.preventDefault(),!sessionStorage.userID)return void alert("401 error: you don't have permission to be here. Sorry. We don't make the rules.");let id=$("#itemIDEdit").val(),itemName=$("#itemNameEdit").val(),itemDescription=$("#itemDescriptionEdit").val(),itemPrice=$("#itemPriceEdit").val(),itemType=$("input[name=itemTypeEdit]:checked").val(),itemCondition=$("input[name=itemConditionEdit]:checked").val();0!=itemName.length&&0!=itemDescription.length&&0!=itemPrice.length?$.ajax({url:`${url}/editItem/${id}`,type:"PATCH",data:{itemName:itemName,itemDescription:itemDescription,itemPrice:itemPrice,itemCondition:itemCondition,itemType:itemType,userId:sessionStorage.userID},success:function(item){console.log(item),$("#editModal").modal("hide"),showItems()},error:function(err){console.log(err),console.log("How embarrassing, a database error! This never usually happens to me.")}}):alert("Please make sure you've put something in all of the fields!")}),$("#cardContainer").on("click",".removeBtn",function(){if(event.preventDefault(),!sessionStorage.userID)return void alert("401, permission denied");const id=$(this).parent().parent().parent().data("id"),card=$(this).parent().parent().parent();$.ajax({url:`${url}/deleteItem/${id}`,type:"DELETE",data:{userID:sessionStorage.userID},success:function(response){"401"==response?alert("401 error: you don't have permission to be here. Sorry. We don't make the rules."):(card.remove(),showItems())},error:function(err){console.log(err),console.log("something went wrong deleting the product")}})}),$("#cardContainer").on("click",".moreInfoBtn",function(){const id=$(this).parent().parent().parent().data("id");$.ajax({url:`${url}/getItem/${id}`,type:"GET",success:function(item){console.log(item),$("#singleItemModalTitle").empty(),$("#singleItemModalTitle").append(item.item_name),$("#singleItemModalBody").empty(),$("#singleItemModalBody").append(`<img class="img-fluid" src="${url}/${item.image_URL}">`),$("#singleItemModalBody").append("<p>Clothing type: "+item.clothing_type+"</p>"),$("#singleItemModalBody").append("<p>Condition: "+item.condition+"</p>"),$("#singleItemModalBody").append("<p>Description: "+item.item_description+"</p>"),$("#singleItemModalBody").append("<p>Price: $"+item.price+"</p>")},error:function(err){console.log(err),console.log("something went wrong with getting the single item")}})}),$("#cardContainer").on("click",".buyBtn",function(){console.log("clicked");const id=$(this).parent().parent().parent().data("id");console.log(id),$.ajax({url:`${url}/buyItem/${id}`,type:"PATCH",success:function(){console.log("changing bought to true in backend"),showItems()},error:function(err){console.log(err),console.log("How embarassing, a database error! This never usually happens to me.")}})}),$("#titleBtn").click(()=>{clearForms(),$(".main").removeClass("d-none"),hideLoginForm(),hideRegisterForm()});